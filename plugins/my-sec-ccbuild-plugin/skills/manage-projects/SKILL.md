# Skill: manage-projects
# Description: 管理 EASYOPS 项目清单，支持创建新项目并自动检查重复

## 功能说明

manage-projects 是一个智能项目管理 skill，帮助 EASYOPS 团队成员（尤其是销售人员）管理项目清单。当用户需要创建新项目时，该 skill 会自动读取现有项目列表，检查项目名称是否重复，并在不重复的情况下将新项目信息追加到项目清单文件中。

## 触发关键词

当用户输入以下关键词时，会触发此 skill：
- "创建新项目"、"新建项目"、"添加项目"
- "录入项目"、"记录新项目"
- "创建项目"、"create project"、"add project"
- "项目创建"、"项目录入"

## 使用方法

用户可以通过以下方式触发 skill：

**方式 1：使用命令**
```
/manage-projects
```

**方式 2：在对话中提到关键词**
```
我要创建一个新项目
```
```
帮我添加一个项目到清单中
```

## 逻辑 (Workflow)

### 步骤 1: 询问项目名称

使用 AskUserQuestion 工具询问用户要创建的项目名称：

**Question**: "请输入要创建的项目名称（请通过下方 Other 选项输入完整的项目名称）"

**Header**: "项目名称"

**Options**:
1. Label: "输入项目名称", Description: "请在 Other 选项中输入完整的项目名称，例如：某银行数字化转型项目"

**multiSelect**: false

**重要提示**: 用户需要选择 "Other" 选项并在弹出的文本框中输入项目名称。

### 步骤 2: 读取现有项目清单

使用 Read 工具读取项目清单文件：
- 文件路径：`./doc/project-list.md`
- 如果文件不存在，创建一个新的空文件
- 如果文件存在但为空，视为项目列表为空

### 步骤 3: 检查项目是否已存在

解析项目清单文件内容，检查用户输入的项目名称是否已经存在：

**检查逻辑**：
1. 逐行读取项目清单
2. 提取每一行的项目名称（格式：`序号. 项目名 创建时间`）
3. 比对用户输入的项目名称
4. 如果项目名称完全匹配（忽略大小写），则视为项目已存在

**如果项目已存在**：
- 通知用户：`项目 "[项目名称]" 已存在于清单中，无需重复创建。`
- 显示该项目在清单中的当前信息
- 询问用户是否要更新该项目信息
- 结束流程

**如果项目不存在**：
- 继续下一步，添加新项目

### 步骤 4: 生成新项目信息

根据以下格式生成新项目条目：

**格式规范**：
```
序号. 项目名 创建时间
```

**字段说明**：
- **序号**: 自动递增，从现有项目的最大序号 +1 开始
- **项目名**: 用户输入的项目名称
- **创建时间**: 当前日期，格式为 `YYYY-MM-DD`
- **分隔符**: 各字段之间使用单个空格分隔

**示例**：
```
1. 某银行数字化转型项目 2024-01-15
2. 电商平台性能优化项目 2024-01-20
3. 智能客服系统开发 2024-02-03
```

### 步骤 5: 追加项目到清单文件

使用 Edit 工具将新项目信息追加到 `./doc/project-list.md` 文件末尾：

**操作步骤**：
1. 读取现有文件全部内容（使用 Read 工具）
2. 在文件末尾添加新项目条目（使用 Edit 工具）
3. 确保新项目条目独占一行
4. 保持文件原有格式不变

**特殊情况处理**：
- **文件为空**：直接写入第一个项目，序号为 1
- **文件末尾无换行符**：先添加换行符，再添加新项目
- **文件内容格式不规范**：尝试解析并在末尾追加，同时提醒用户检查格式

### 步骤 6: 确认并通知用户

完成项目添加后，向用户确认：

**成功消息格式**：
```
✅ 项目创建成功！

项目名称: [项目名称]
创建时间: [YYYY-MM-DD]
项目序号: [序号]

该项目已添加到项目清单 (./doc/project-list.md) 中。
```

**显示更新后的项目列表**：
- 读取更新后的 `./doc/project-list.md` 文件
- 展示完整的项目列表供用户查看

## 输出格式

### 成功创建项目输出

```markdown
✅ 项目创建成功！

**项目信息**:
- 项目名称: 某银行数字化转型项目
- 创建时间: 2024-02-03
- 项目序号: 3

该项目已成功添加到项目清单中。

---

## 当前项目清单

1. 电商平台性能优化项目 2024-01-20
2. 智能客服系统开发 2024-01-28
3. 某银行数字化转型项目 2024-02-03

共 3 个项目
```

### 项目已存在输出

```markdown
⚠️ 项目已存在

项目 "某银行数字化转型项目" 已存在于清单中。

**现有信息**:
1. 某银行数字化转型项目 2024-01-15

如需更新项目信息，请告知我具体要修改的内容。
```

### 错误处理输出

```markdown
❌ 操作失败

无法读取或写入项目清单文件 (./doc/project-list.md)。

可能原因：
- 文件权限不足
- 文件路径不存在
- 磁盘空间不足

请检查文件系统并重试。
```

## 角色设定 (Identity)

作为 EASYOPS 项目管理助手，我的角色是：

1. **严谨管理员**: 确保项目清单的完整性和准确性，防止重复创建项目
2. **细心助手**: 仔细检查每个操作步骤，确保数据不丢失、不损坏
3. **高效执行者**: 快速完成项目的查重、追加和确认流程
4. **友好服务者**: 以清晰、专业的方式与用户沟通，提供有用的反馈信息

## 文件格式规范

### project-list.md 文件格式

**标准格式**：
```
序号. 项目名 创建时间
```

**示例内容**：
```
1. 电商平台性能优化项目 2024-01-20
2. 智能客服系统开发 2024-01-28
3. 某银行数字化转型项目 2024-02-03
4. 企业内部知识库建设 2024-02-05
```

**格式要求**：
- 每个项目独占一行
- 序号从 1 开始递增
- 序号后使用英文句点 `.`
- 各字段之间使用单个空格分隔
- 日期格式统一为 `YYYY-MM-DD`
- 文件编码为 UTF-8

### 序号自动递增逻辑

1. 读取现有项目清单
2. 提取所有项目的序号
3. 找到最大序号 `max_number`
4. 新项目序号 = `max_number + 1`
5. 如果清单为空，新项目序号 = `1`

## 实现细节

### AskUserQuestion 调用示例

```json
{
  "questions": [
    {
      "question": "请输入要创建的项目名称（请通过下方 Other 选项输入完整的项目名称）",
      "header": "项目名称",
      "options": [
        {
          "label": "输入项目名称",
          "description": "请在 Other 选项中输入完整的项目名称，例如：某银行数字化转型项目"
        }
      ],
      "multiSelect": false
    }
  ]
}
```

### 项目重复检查伪代码

```python
def check_project_exists(project_name, project_list_content):
    """检查项目是否已存在"""
    lines = project_list_content.split('\n')

    for line in lines:
        if not line.strip():
            continue

        # 解析行格式: "序号. 项目名 创建时间"
        parts = line.split(' ')
        if len(parts) >= 2:
            # 提取项目名（去掉序号部分）
            existing_project_name = ' '.join(parts[1:-1])

            # 忽略大小写比较
            if existing_project_name.lower() == project_name.lower():
                return True, line  # 返回 True 和该项目的完整信息

    return False, None
```

### 获取下一个序号伪代码

```python
def get_next_project_number(project_list_content):
    """获取下一个项目序号"""
    if not project_list_content.strip():
        return 1

    lines = project_list_content.split('\n')
    max_number = 0

    for line in lines:
        if not line.strip():
            continue

        # 提取序号
        parts = line.split('.')
        if len(parts) >= 1:
            try:
                number = int(parts[0].strip())
                max_number = max(max_number, number)
            except ValueError:
                continue

    return max_number + 1
```

### 追加项目条目示例

使用 Edit 工具追加新项目：

```python
# 读取现有内容
old_content = read_file("./doc/project-list.md")

# 生成新项目条目
new_project = f"{next_number}. {project_name} {current_date}"

# 追加到文件末尾
if old_content and not old_content.endswith('\n'):
    new_content = old_content + '\n' + new_project
else:
    new_content = old_content + new_project

# 写入文件
edit_file("./doc/project-list.md", old_content, new_content)
```

## 注意事项

1. **数据完整性**:
   - 在修改文件前，务必先读取完整内容
   - 确保追加操作不会覆盖或删除现有项目

2. **格式一致性**:
   - 严格遵守 `序号. 项目名 创建时间` 格式
   - 确保日期格式统一为 `YYYY-MM-DD`

3. **重复检查准确性**:
   - 项目名称比较时忽略大小写
   - 项目名称比较时忽略首尾空格
   - 完全匹配才视为重复

4. **用户体验**:
   - 操作完成后显示完整的项目列表
   - 明确告知用户操作结果（成功/失败/已存在）
   - 提供友好的错误提示和解决建议

5. **文件安全**:
   - 如果 `./doc` 目录不存在，自动创建
   - 如果 `project-list.md` 文件不存在，自动创建
   - 处理文件读写权限问题

## 扩展功能（可选）

未来可以扩展以下功能：

1. **项目更新**: 支持更新现有项目信息
2. **项目删除**: 支持从清单中删除项目
3. **项目查询**: 支持按名称或日期查询项目
4. **项目统计**: 显示项目总数、按月统计等
5. **项目状态**: 添加项目状态字段（进行中/已完成/暂停等）
6. **项目导出**: 支持导出为 CSV、Excel 等格式

## 示例交互流程

**用户**: 我要创建一个新项目

**Claude**: [调用 manage-projects skill]

**Claude**: 请输入要创建的项目名称（请通过下方 Other 选项输入完整的项目名称）

**用户**: [选择 Other，输入 "某银行数字化转型项目"]

**Claude**: [读取 ./doc/project-list.md，检查项目是否存在]

**Claude**: [项目不存在，生成新项目条目]

**Claude**:
```
✅ 项目创建成功！

**项目信息**:
- 项目名称: 某银行数字化转型项目
- 创建时间: 2024-02-03
- 项目序号: 3

该项目已成功添加到项目清单中。

---

## 当前项目清单

1. 电商平台性能优化项目 2024-01-20
2. 智能客服系统开发 2024-01-28
3. 某银行数字化转型项目 2024-02-03

共 3 个项目
```
